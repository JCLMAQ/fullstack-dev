<div class="flex gap-2 min-h-screen items-center justify-center bg-background">
<div
  class="w-full max-w-[400px] ml-[200px] p-10 rounded-2xl shadow-xl bg-surface-container border border-outline-variant"
>
  <h1 class="text-2xl mb-2 text-on-surface">{{"CHANGEPWD.title" | translate}}</h1>
 <br>

  <div class="flex flex-col gap-5">
    <form>
      <!-- Hidden username field for accessibility -->
      <input
        type="text"
        name="username"
        autocomplete="username"
        style="display: none;"
        aria-hidden="true"
      />

      <mat-form-field class="w-full">
        <mat-label>{{ "CHANGEPWD.currentPasswordLabel" | translate }}</mat-label>
        <input
          matInput
          [type]="hideOldPassword() ? 'password' : 'text'"
          placeholder="{{ 'CHANGEPWD.currentPasswordPlaceholder' | translate }}"
          autocomplete="current-password"
          [field]="changepwdForm.oldPassword"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          class="mr-1"
          (click)="hideOldPassword.set(!hideOldPassword())"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideOldPassword()"
        >
          <mat-icon>{{ hideOldPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>

        <!-- Bad password control -->

          <lib-field-error [fieldError]="changepwdForm.oldPassword()" />
      </mat-form-field>

<br>

      <mat-form-field class="w-full">
        <mat-label>{{"CHANGEPWD.newPasswordLabel" | translate}}</mat-label>
        <input
          matInput
          [type]="hideNewPassword() ? 'password' : 'text'"
          placeholder="{{ 'CHANGEPWD.newPasswordPlaceholder' | translate }}"
          autocomplete="new-password"
          [field]="changepwdForm.newPassword"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideNewPassword.set(!hideNewPassword())"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideNewPassword()"
        >
          <mat-icon>{{ hideNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>

          <!-- Indicateur de force du mot de passe -->
            @if (changepwdForm.newPassword().value().length > 0) {
            <div class="mt-2">
              <div class="flex items-center gap-2 text-sm">
                <span>{{"CHANGEPWD.passwordStrength" | translate}}</span>
                <span [style.color]="passwordStrength().color" class="font-medium">
                  {{ passwordStrength().label }}
                </span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                <div
                  class="h-2 rounded-full transition-all duration-300"
                  [style.width.%]="passwordStrength().score * 20"
                  [style.background-color]="passwordStrength().color"
                ></div>
              </div>
            </div>
            }
        <lib-field-error [fieldError]="changepwdForm.newPassword()" />
      </mat-form-field>

      <br>

      <mat-form-field>
        <mat-label>{{"CHANGEPWD.confirmNewPasswordLabel" | translate}}</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword() ? 'password' : 'text'"
          placeholder="{{ 'CHANGEPWD.confirmNewPasswordPlaceholder' | translate }}"
          autocomplete="new-password"
          [field]="changepwdForm.confirmPassword"
        />
        <button
          mat-icon-button
          matSuffix
          class="mr-1"
          type="button"
          (click)="hideConfirmPassword.set(!hideConfirmPassword())"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideConfirmPassword()"
        >
          <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <lib-field-error [fieldError]="changepwdForm.confirmPassword()" />

            <!-- Indicateur de correspondance des mots de passe -->
            @if (changepwdForm.newPassword().value().length > 0 && changepwdForm.confirmPassword().value().length > 0) {
              <div class="mt-1 flex items-center gap-1 text-sm">
                @if (passwordsMatch()) {
                <mat-icon class="text-green-500 text-sm">check_circle</mat-icon>
                <span class="text-green-600">Passwords match</span>
                } @else {
                <mat-icon class="text-red-500 text-sm">cancel</mat-icon>
                <span class="text-red-600">Passwords don't match</span>
                }
              </div>
            }

      </mat-form-field>
</form>
        <!--  Submit button  -->
    <button
      mat-flat-button
      class="w-full mt-3"
      type="button"
      (click)="changePwd()"
      [disabled]="!changepwdForm().valid() || isSubmitting()"
    >
      {{ "CHANGEPWD.submitButton" | translate }}
    </button>

  </div>
<br>
  <div class="flex gap-1 mb-8 text-sm text-on-surface">
      <br>
      <span>{{"CHANGEPWD.wantToReset" | translate }}</span>
      <button
        type="button"
        class="text-primary cursor-pointer bg-transparent border-none underline"
        (click)="resetForm()"
      >
        {{"CHANGEPWD.resetFormButton" | translate}}
      </button>
  </div>

  <div class="flex gap-1 mb-8 text-sm text-on-surface">
    <span>{{"CHANGEPWD.wantToCancel" | translate}}</span>
    <button
      type="button"
      class=" text-primary cursor-pointer bg-transparent border-none underline"
      (click)="cancel()"
    >
      {{"CHANGEPWD.cancelButton" | translate}}
    </button>
  </div>

</div>
</div>

<!--  debugging info -->
<mat-card class="debug-card">
      <mat-card-header>
        <mat-card-title>Form Data</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <pre class="debug-pre">{{ changepwdForm().value() | json }}</pre>
        <pre class="debug-pre">{{ changepwdForm().errorSummary() | json }}</pre>
      </mat-card-content>
</mat-card>
