<div class="carousel-config-container">
      <!-- Hidden file input -->
      <input
        #fileInput
        type="file"
        accept="image/*"
        multiple
        style="display: none"
        (change)="onFileSelected($event)"
      />

      <mat-card>
        <mat-card-header>
          <mat-card-title>
            {{ 'CAROUSEL_CONFIG.TITLE' | translate }}
          </mat-card-title>
          <mat-card-subtitle>
            {{ 'CAROUSEL_CONFIG.SUBTITLE' | translate }}
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <!-- Upload Button -->
          <div class="upload-section">
            <button
              mat-raised-button
              color="primary"
              (click)="onUploadImages()"
            >
              <mat-icon>add_photo_alternate</mat-icon>
              {{ 'CAROUSEL_CONFIG.UPLOAD_IMAGES' | translate }}
            </button>

            <button
              mat-raised-button
              (click)="toggleLibraryMode()"
            >
              <mat-icon>{{ showAllImages() ? 'filter_list' : 'photo_library' }}</mat-icon>
              {{ showAllImages() ? ('CAROUSEL_CONFIG.SHOW_CAROUSEL_ONLY' | translate) : ('CAROUSEL_CONFIG.SHOW_ALL_IMAGES' | translate) }}
            </button>

            <button
              mat-raised-button
              [disabled]="availableImages().length === 0"
              (click)="toggleSelectAll()"
            >
              <mat-icon>{{ selectedImages().length > 0 ? 'deselect' : 'select_all' }}</mat-icon>
              {{ selectedImages().length > 0 ? ('CAROUSEL_CONFIG.DESELECT_ALL' | translate) : ('CAROUSEL_CONFIG.SELECT_ALL' | translate) }}
            </button>

            <button
              mat-raised-button
              color="accent"
              [disabled]="selectedImages().length === 0"
              (click)="toggleCarouselTagForSelected()"
            >
              <mat-icon>swap_horiz</mat-icon>
              {{ 'CAROUSEL_CONFIG.TOGGLE_CAROUSEL_TAG' | translate }}
            </button>

            @if (selectedImages().length > 0) {
              <div class="selection-info-inline">
                <mat-icon>check_circle</mat-icon>
                <span>{{ selectedImages().length }} {{ 'CAROUSEL_CONFIG.IMAGES_SELECTED' | translate }}</span>
              </div>
            }
          </div>

          <!-- Selected Images Section -->
          @if (selectedImages().length > 0) {
            <div class="selected-images-section">
              <h3 class="section-title">
                <mat-icon>collections</mat-icon>
                {{ 'CAROUSEL_CONFIG.SELECTED_IMAGES_TITLE' | translate }}
              </h3>
              <div class="selected-images-grid">
                @for (image of selectedImages(); track image.id) {
                  <div class="selected-image-card">
                    <img
                      [src]="imageUrls()[image.id]"
                      [alt]="image.altText || image.originalName"
                      class="selected-image-thumbnail"
                    />
                    <button
                      mat-icon-button
                      color="warn"
                      class="remove-button"
                      (click)="removeFromSelection(image)"
                      [attr.aria-label]="'Remove ' + image.originalName"
                    >
                      <mat-icon>close</mat-icon>
                    </button>
                    <div class="selected-image-name">{{ image.originalName }}</div>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Loading State -->
          @if (loading()) {
            <div class="loading-container">
              <mat-progress-spinner diameter="50" mode="indeterminate"></mat-progress-spinner>
              <p>{{ 'CAROUSEL_CONFIG.LOADING' | translate }}</p>
            </div>
          }

          <!-- Image Selection Grid -->
          @if (!loading() && availableImages().length > 0) {
            <div class="images-grid">
              @for (image of availableImages(); track image.id) {
                <div
                  class="image-card"
                  [class.selected]="isSelected(image.id)"
                  (click)="toggleImageSelection(image)"
                  (keyup.enter)="toggleImageSelection(image)"
                  (keyup.space)="toggleImageSelection(image)"
                  tabindex="0"
                  role="button"
                  [attr.aria-label]="'Toggle image: ' + image.originalName"
                >
                  <!-- Checkbox overlay -->
                  <div class="checkbox-overlay">
                    <mat-checkbox
                      [checked]="isSelected(image.id)"
                      (click)="$event.stopPropagation()"
                      (change)="toggleImageSelection(image)"
                    ></mat-checkbox>
                  </div>

                  <!-- Selected badge -->
                  @if (isSelected(image.id)) {
                    <div class="selected-badge">
                      <mat-icon>check_circle</mat-icon>
                    </div>
                  }

                  <!-- Image -->
                  <img
                    [src]="imageUrls()[image.id]"
                    [alt]="image.altText || image.originalName"
                    class="image-thumbnail"
                  />

                  <!-- Image info -->
                  <div class="image-info">
                    <div class="flex items-center justify-between gap-2 mb-1">
                      <p class="image-name">{{ image.originalName }}</p>
                      @if (image.tags && image.tags.includes('carousel')) {
                        <div class="carousel-tag-badge-inline">
                          <mat-icon>view_carousel</mat-icon>
                        </div>
                      }
                    </div>
                    @if (image.description) {
                      <p class="image-description">{{ image.description }}</p>
                    }
                    <div class="flex items-center gap-1 mt-1">
                      <mat-icon
                        [class]="image.isPublic ? 'text-green-600 dark:text-green-400' : 'text-gray-400 dark:text-gray-500'"
                        class="text-xs"
                      >
                        {{ image.isPublic ? 'public' : 'lock' }}
                      </mat-icon>
                      <button
                        mat-button
                        class="!text-xs !py-0 !px-2 !min-w-0"
                        (click)="togglePublicStatus(image, $event)"
                      >
                        {{ image.isPublic ? ('CAROUSEL_CONFIG.MAKE_PRIVATE' | translate) : ('CAROUSEL_CONFIG.MAKE_PUBLIC' | translate) }}
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          }

          <!-- Empty State -->
          @if (!loading() && availableImages().length === 0) {
            <div class="empty-state">
              <mat-icon>photo_library</mat-icon>
              <p>{{ 'CAROUSEL_CONFIG.NO_IMAGES' | translate }}</p>
              <button
                mat-raised-button
                color="primary"
                (click)="onUploadImages()"
              >
                <mat-icon>add_photo_alternate</mat-icon>
                {{ 'CAROUSEL_CONFIG.UPLOAD_FIRST_IMAGE' | translate }}
              </button>
            </div>
          }
        </mat-card-content>
      </mat-card>
    </div>
