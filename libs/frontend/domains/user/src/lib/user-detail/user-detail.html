<div class="container">

  <!-- Loading Spinner -->

  @if (this.userStore.isLoading()) {
    <div class="loading-spinner">
      <mat-spinner></mat-spinner>
    </div>
  }

  @if (!this.userStore.isLoading()) {

    <div class="header">
      <h1 class="mat-headline-4">{{ 'userProfile.title' | translate }}</h1>
      <p class="mat-body-1">
        {{ 'userProfile.profileSubtitle' | translate }}
      </p>
    </div>

    <!-- Main Content -->
    <div class="content">
      <mat-card class="form-card">
        <mat-card-content>
          <form class="form-container">
            <mat-tab-group>
              <!-- Onglet Informations de base -->
              <mat-tab label="{{ 'userProfile.basicInfoSection' | translate }}">
                <section class="form-section">
                  <div class="tab-content">
                    <div class="fields-row">
                      <mat-form-field appearance="outline">
                        <mat-label>ID</mat-label>
                        <input matInput [value]="userForm().value().id" readonly />
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Email</mat-label>
                        <input matInput [field]="userForm.email" [readOnly]="mode() === 'view' || mode() === 'edit'" type="email" placeholder="Enter email" />
                      </mat-form-field>
                    </div>
                    <div class="fields-row">
                      <mat-form-field appearance="outline">
                        <mat-label>{{'userProfile.jobTitleLabel' | translate}}</mat-label>
                        <input matInput [field]="userForm.jobTitle" [readOnly]="mode() === 'view' || mode() === 'edit'" placeholder="{{'userProfile.jobTitlePlaceholder' | translate}}" />
                        <mat-error>
                          <lib-field-error [fieldError]="userForm.jobTitle()" />
                        </mat-error>
                      </mat-form-field>
                    </div>
                  </div>
                </section>
              </mat-tab>
              <!-- Onglet Statut -->
              <mat-tab label="{{ 'userProfile.statusSection' | translate }}">
                <section class="form-section">
                  <div class="tab-content">
                    <div class="fields-row">
                      <mat-form-field appearance="outline">
                        <mat-label>Is Validated</mat-label>
                        <ng-container>
                          <input matInput [field]="userForm.isValidated" [readOnly]="mode() === 'view' || mode() === 'edit'" [matDatepicker]="validatedPicker" />
                          <mat-datepicker-toggle matSuffix [for]="validatedPicker"></mat-datepicker-toggle>
                          <mat-datepicker #validatedPicker></mat-datepicker>
                        </ng-container>
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Is Suspended</mat-label>
                        <ng-container>
                          <input matInput [field]="userForm.isSuspended" [readOnly]="mode() === 'view' || mode() === 'edit'" [matDatepicker]="suspendedPicker" />
                          <mat-datepicker-toggle matSuffix [for]="suspendedPicker"></mat-datepicker-toggle>
                          <mat-datepicker #suspendedPicker></mat-datepicker>
                        </ng-container>
                      </mat-form-field>
                    </div>
                  </div>
                </section>
              </mat-tab>
              <!-- Onglet Contact (exemple, Ã  adapter selon les champs disponibles) -->
              <mat-tab label="{{ 'userProfile.contactSection' | translate }}">
                <section class="form-section">
                  <div class="tab-content">
                    <div class="fields-row">
                      <mat-form-field appearance="outline">
                        <mat-label>{{'userProfile.firstNameLabel' | translate}}</mat-label>
                        <input matInput [field]="userForm.firstName" [readOnly]="mode() === 'view' || mode() === 'edit'" placeholder="{{'userProfile.firstNamePlaceholder' | translate}}" />
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>{{'userProfile.lastNameLabel' | translate}}</mat-label>
                        <input matInput [field]="userForm.lastName" [readOnly]="mode() === 'view' || mode() === 'edit'" placeholder="{{'userProfile.lastNamePlaceholder' | translate}}" />
                      </mat-form-field>
                    </div>
                  </div>
                </section>
              </mat-tab>
            </mat-tab-group>
          </form>
        </mat-card-content>
      </mat-card>
    </div> <!-- .content -->
    <mat-toolbar class="bottom-toolbar">
      <!-- Admin Actions -->
      @if (isAdmin()) {
        <button
          mat-icon-button
          matTooltip="Permanent Delete"
          [disabled]="!isAdmin() || mode() === 'edit'"
          (click)="remove()"
          class="danger-btn">
          <mat-icon>delete_forever</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Virtual Delete" [disabled]="!isAdmin() || mode() === 'edit'" (click)="virtualRemove()" class="warning-btn">
          <mat-icon>delete</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Add record" [disabled]="!isAdmin()" (click)="add()" class="success-btn">
          <mat-icon>add_circle</mat-icon>
        </button>
      }
      <mat-divider [vertical]="true"></mat-divider>
      <!-- Form Actions -->
      <button mat-icon-button matTooltip="Cancel" [disabled]="mode() === 'view'" (click)="cancel()">
        <mat-icon>cancel</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Save changes" [disabled]="mode() === 'view'" (click)="save()" class="success-btn">
        <mat-icon>check_circle</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Edit" [disabled]="mode() === 'edit'" (click)="mode.set('edit')">
        <mat-icon>edit</mat-icon>
      </button>
      <mat-divider [vertical]="true"></mat-divider>
      <!-- Navigation Buttons -->
      @if (this.userStore.selectedUsers().length > 1) {
        <button mat-icon-button matTooltip="First record" [disabled]="userStore.navigation().isFirst" (click)="first()">
          <mat-icon>first_page</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Previous record" [disabled]="!userStore.navigation().hasPrevious" (click)="previous()">
          <mat-icon>skip_previous</mat-icon>
        </button>
        <span class="navigation-indicator">
          {{ userStore.currentPosition() + 1 }} / {{ this.userStore.selectedUsers().length}}
        </span>
        <button mat-icon-button matTooltip="Next record" [disabled]="!userStore.navigation().hasNext" (click)="next()">
          <mat-icon>skip_next</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Last record" [disabled]="userStore.navigation().isLast" (click)="last()">
          <mat-icon>last_page</mat-icon>
        </button>
      }
      <mat-divider [vertical]="true"></mat-divider>
      <!-- Utility Buttons -->
      <button mat-icon-button matTooltip="Reset" (click)="reload()">
        <mat-icon>autorenew</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Back to list" (click)="goBack()">
        <mat-icon>exit_to_app</mat-icon>
      </button>
    </mat-toolbar>
  }
