---
description: "Guidelines for importing Prisma types in browser/frontend vs Node.js/backend contexts"
applyTo: "**/*.ts"
---

# Prisma Import Guidelines

## Critical Rule: Browser vs Server Imports

Prisma Client cannot run in the browser. Always use the appropriate import based on your context:

### ❌ NEVER in Frontend Code
```typescript
// ❌ This will cause "fileURLToPath is not a function" errors in the browser
import { User, Role } from '@db/prisma';
import { PrismaClient } from '@db/prisma';
```

### ✅ Frontend (Browser) - Types Only
```typescript
// ✅ Use browser-safe import for types and enums
import { User, Role, Organization, Image } from '@db/prisma/browser';
import type { Phone, Address } from '@db/prisma/browser';
```

### ✅ Backend (Node.js) - Full Client
```typescript
// ✅ Backend can use the full Prisma client
import { User, PrismaClient } from '@db/prisma';
import { PrismaClientService } from '@db/prisma-client';
```

## Why This Matters

- **Prisma Client** uses Node.js-specific APIs (`fs`, `path`, `url`) that don't exist in browsers
- The `/browser` export provides **types only** using `browser.ts` generated by Prisma
- The standard export includes `PrismaClient` class which imports Node.js modules

## File Structure

```
libs/prisma/src/
  ├── index.ts           # Server exports (includes PrismaClient)
  ├── browser.ts         # Browser exports (types only)
  └── lib/generated/prisma/
      ├── client.ts      # Full client (Node.js)
      └── browser.ts     # Browser types
```

## TypeScript Path Mapping

In `tsconfig.base.json`:
```json
{
  "paths": {
    "@db/prisma": ["libs/prisma/src/index.ts"],           // Backend
    "@db/prisma/browser": ["libs/prisma/src/browser.ts"], // Frontend
    "@db/prisma-client": ["libs/backend/prisma-client/src/index.ts"]
  }
}
```

## Common Error Messages

If you see these errors in the browser console, you're importing from the wrong path:

- `fileURLToPath is not a function`
- `Cannot find module 'node:process'`
- `Cannot find module 'node:path'`
- `Runtime error in @prisma/client/runtime`

**Solution**: Change `from '@db/prisma'` to `from '@db/prisma/browser'` in frontend files.

## Code Review Checklist

- [ ] All `libs/frontend/**/*.ts` files use `@db/prisma/browser`
- [ ] All `libs/backend/**/*.ts` files use `@db/prisma` or `@db/prisma-client`
- [ ] No `PrismaClient` instantiation in frontend code
- [ ] Frontend only imports types (User, Role, etc.), not runtime code
